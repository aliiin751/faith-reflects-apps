<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaithReflects - Jericho Walls</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #191919;
            color: #E3E3E3;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow-x: hidden;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #191919; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        .animate-slide-up { animation: slideUp 0.4s ease-out; }
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .animate-crumble { animation: crumble 1.5s forwards ease-in-out; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        @keyframes crumble {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            20% { transform: translateY(10px) scale(1.05) rotate(2deg); opacity: 1; }
            100% { transform: translateY(200px) scale(0.8) rotate(-5deg); opacity: 0; }
        }

        /* Light Rays for Victory */
        .ray-box {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 0;
            pointer-events: none;
        }
        .ray {
            background: linear-gradient(to top, rgba(159, 107, 83, 0.3), transparent);
            width: 40px;
            height: 300px;
            position: absolute;
            transform-origin: bottom center;
            opacity: 0; 
        }
        .victory .ray {
            animation: raySpin 10s infinite linear;
            opacity: 1;
        }
        @keyframes raySpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONS ---
        const Icons = {
            Trumpet: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 10v4"/><path d="M19 14V10"/><path d="M19 10L8 7"/><path d="M19 14L8 17"/><path d="M2 10a2 2 0 0 0-2 2v0a2 2 0 0 0 2 2h3v-4Z"/><path d="M22 8v8"/></svg>,
            Refresh: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Check: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            ArrowLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Trash: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Alert: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        };

        const { useState, useEffect } = React;

        // --- WALL COMPONENT ---
        const Walls = ({ progress, isCrumbled }) => {
            const wallColor = "#3E3E3E";
            const accentColor = "#2C2C2C";
            const crackColor = "#111";

            return (
                <div className={`relative w-full max-w-[280px] h-[200px] flex items-end justify-center mb-8 mx-auto z-10 ${isCrumbled ? 'animate-crumble' : ''}`}>
                    <svg viewBox="0 0 280 200" className="w-full h-full drop-shadow-2xl">
                        
                        {/* Background/Base */}
                        <rect x="20" y="180" width="240" height="10" fill="#252525" rx="2" />

                        {/* Wall Structure */}
                        <g>
                            {/* Left Tower */}
                            <path d="M40 180 V60 H80 V180" fill={wallColor} stroke={accentColor} strokeWidth="2" />
                            <rect x="45" y="70" width="30" height="10" fill={accentColor} /> {/* Window */}
                            <path d="M40 60 H50 V50 H60 V60 H70 V50 H80 V60" fill={wallColor} stroke={accentColor} /> {/* Battlements */}

                            {/* Right Tower */}
                            <path d="M200 180 V60 H240 V180" fill={wallColor} stroke={accentColor} strokeWidth="2" />
                            <rect x="205" y="70" width="30" height="10" fill={accentColor} />
                            <path d="M200 60 H210 V50 H220 V60 H230 V50 H240 V60" fill={wallColor} stroke={accentColor} />

                            {/* Central Wall (The Gate) */}
                            <path d="M80 180 V80 H200 V180" fill={wallColor} stroke={accentColor} strokeWidth="2" />
                            
                            {/* Gate Door */}
                            <path d="M110 180 V100 Q140 80 170 100 V180" fill="#252525" stroke="#111" strokeWidth="2" />
                            <path d="M140 180 V100" stroke="#111" strokeWidth="2" /> {/* Gate Split */}
                        </g>

                        {/* Cracks (Visible based on progress) */}
                        {progress >= 2 && <path d="M60 100 L55 120 L65 130" stroke={crackColor} strokeWidth="2" fill="none" opacity="0.6" />}
                        {progress >= 3 && <path d="M220 90 L225 110 L215 120" stroke={crackColor} strokeWidth="2" fill="none" opacity="0.6" />}
                        {progress >= 4 && <path d="M120 120 L130 140 L125 150" stroke={crackColor} strokeWidth="2" fill="none" opacity="0.7" />}
                        {progress >= 5 && <path d="M160 110 L150 130 L165 140" stroke={crackColor} strokeWidth="2" fill="none" opacity="0.7" />}
                        {progress >= 6 && <path d="M90 90 L100 160 M190 90 L180 160" stroke={crackColor} strokeWidth="3" fill="none" opacity="0.8" />}

                    </svg>
                </div>
            );
        };

        // --- VICTORY SCREEN ---
        const VictoryDisplay = ({ goal, onComplete }) => (
            <div className="absolute inset-0 flex flex-col items-center justify-center z-20 animate-fade-in bg-black/60 backdrop-blur-sm p-6 text-center">
                <div className="mb-4 text-4xl">üôå</div>
                <h2 className="text-2xl font-bold text-white mb-2">Breakthrough!</h2>
                <p className="text-[#9F6B53] text-xs font-bold uppercase tracking-widest mb-4">Joshua 6:20</p>
                
                <div className="bg-[#202020] p-4 rounded-xl border border-[#9F6B53] w-full mb-6">
                    <p className="text-[10px] text-stone-500 uppercase tracking-widest mb-1">Wall Collapsed</p>
                    <p className="text-white font-medium">"{goal}"</p>
                </div>

                <button 
                    onClick={onComplete}
                    className="px-6 py-3 bg-[#9F6B53] text-white rounded-lg hover:bg-[#8F5B43] transition-colors text-xs font-bold uppercase tracking-widest flex items-center gap-2"
                >
                    <Icons.Check size={16} /> Mark as Done
                </button>
            </div>
        );

        // --- GOAL LIST ITEM ---
        const GoalCard = ({ goal, onSelect, onDelete }) => {
            const [confirming, setConfirming] = useState(false);
            const percent = (goal.progress / 7) * 100;

            useEffect(() => {
                let timer;
                if(confirming) {
                    timer = setTimeout(() => setConfirming(false), 3000);
                }
                return () => clearTimeout(timer);
            }, [confirming]);

            const handleDelete = (e) => {
                e.stopPropagation();
                if(confirming) {
                    onDelete(goal.id);
                } else {
                    setConfirming(true);
                }
            };

            return (
                <div 
                    onClick={() => onSelect(goal.id)}
                    className="group bg-[#202020] p-4 rounded-xl border border-[#333] hover:border-[#555] transition-all cursor-pointer mb-3 relative overflow-hidden"
                >
                    <div className="flex justify-between items-start mb-2 relative z-10">
                        <h3 className="font-bold text-stone-200 text-sm truncate pr-6">{goal.title}</h3>
                        <span className="text-[10px] text-stone-500 font-mono">{goal.progress}/7</span>
                    </div>
                    
                    {/* Progress Bar */}
                    <div className="w-full h-1.5 bg-[#2C2C2C] rounded-full overflow-hidden relative z-10">
                        <div 
                            className="h-full bg-[#9F6B53] transition-all duration-500" 
                            style={{width: `${percent}%`}}
                        ></div>
                    </div>

                    <button 
                        onClick={handleDelete}
                        className={`absolute top-2 right-2 transition-all z-20 p-1 rounded ${confirming ? 'bg-red-500/10 text-red-500 opacity-100' : 'text-stone-600 hover:text-red-400 opacity-0 group-hover:opacity-100'}`}
                        title={confirming ? "Click again to delete" : "Delete"}
                    >
                        {confirming ? <Icons.X size={12} /> : <Icons.Trash size={12} />}
                    </button>
                </div>
            );
        };

        // --- MAIN APP ---
        function App() {
            // State
            const [goals, setGoals] = useState(() => {
                const saved = localStorage.getItem('faithreflects_jericho_v2');
                try {
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });
            const [activeGoalId, setActiveGoalId] = useState(null);
            const [isAdding, setIsAdding] = useState(false);
            const [newGoalTitle, setNewGoalTitle] = useState("");
            
            // Animation States for Active View
            const [isShaking, setIsShaking] = useState(false);

            // Save State
            useEffect(() => {
                localStorage.setItem('faithreflects_jericho_v2', JSON.stringify(goals));
            }, [goals]);

            // Handlers
            const addGoal = () => {
                if (!newGoalTitle.trim()) return;
                const newGoal = { 
                    id: Date.now(), 
                    title: newGoalTitle, 
                    progress: 0 
                };
                setGoals(prev => [newGoal, ...prev]);
                setNewGoalTitle("");
                setIsAdding(false);
                setActiveGoalId(newGoal.id); // Jump to new goal
            };

            // Direct delete (called by UI that has already confirmed)
            const deleteGoal = (id) => {
                setGoals(prev => prev.filter(g => g.id !== id));
                if (activeGoalId === id) setActiveGoalId(null);
            };

            const updateProgress = (id, increment) => {
                if (increment) {
                    setIsShaking(true);
                    setTimeout(() => setIsShaking(false), 500);
                }
                
                setGoals(prev => prev.map(g => {
                    if (g.id !== id) return g;
                    const newProgress = Math.min(g.progress + 1, 7);
                    return { ...g, progress: newProgress };
                }));
            };

            // Views
            const activeGoal = goals.find(g => g.id === activeGoalId);
            const isVictory = activeGoal && activeGoal.progress >= 7;

            // --- VIEW: DASHBOARD ---
            if (!activeGoalId) {
                return (
                    <div className="min-h-screen bg-[#191919] text-[#E3E3E3] font-sans flex flex-col p-4 max-w-sm mx-auto">
                        <header className="flex justify-between items-center mb-6">
                            <div className="flex items-center space-x-1.5 text-stone-300">
                                <span className="text-xl">‚ú®</span>
                                <span className="font-semibold tracking-tight text-base font-serif">FaithReflects</span>
                            </div>
                            <span className="text-[10px] bg-[#2C2C2C] px-2 py-1 rounded text-[#9F6B53] border border-[#333]">Jericho</span>
                        </header>

                        <div className="flex-1 overflow-y-auto pb-20 custom-scroll">
                            <h1 className="text-lg font-bold text-white mb-4 px-1">Your Battles</h1>
                            
                            {goals.length === 0 ? (
                                <div className="text-center py-12 opacity-40">
                                    <div className="text-4xl mb-2 grayscale">üè∞</div>
                                    <p className="text-xs">No active sieges.</p>
                                    <p className="text-[10px]">Add a goal to start marching.</p>
                                </div>
                            ) : (
                                goals.map(g => (
                                    <GoalCard 
                                        key={g.id} 
                                        goal={g} 
                                        onSelect={setActiveGoalId} 
                                        onDelete={deleteGoal} 
                                    />
                                ))
                            )}

                            {isAdding && (
                                <div className="bg-[#2C2C2C] p-3 rounded-xl border border-[#9F6B53] mb-3 animate-fade-in">
                                    <input 
                                        autoFocus
                                        value={newGoalTitle}
                                        onChange={(e) => setNewGoalTitle(e.target.value)}
                                        placeholder="Name your wall..."
                                        className="w-full bg-transparent text-sm text-white outline-none placeholder-stone-500 mb-2"
                                        onKeyPress={(e) => e.key === 'Enter' && addGoal()}
                                    />
                                    <div className="flex justify-end gap-2">
                                        <button onClick={() => setIsAdding(false)} className="text-[10px] text-stone-400 hover:text-white px-2 py-1">Cancel</button>
                                        <button onClick={addGoal} disabled={!newGoalTitle.trim()} className="bg-[#9F6B53] text-white text-[10px] font-bold px-3 py-1 rounded hover:bg-[#8F5B43]">Add</button>
                                    </div>
                                </div>
                            )}
                        </div>

                        {!isAdding && (
                            <button 
                                onClick={() => setIsAdding(true)}
                                className="w-full py-3 rounded-xl border border-dashed border-[#444] text-stone-400 hover:text-white hover:border-stone-300 hover:bg-[#202020] transition-all flex items-center justify-center gap-2 text-xs font-bold uppercase tracking-widest mt-auto"
                            >
                                <Icons.Plus size={16} /> Start New Siege
                            </button>
                        )}
                        
                        <footer className="mt-6 text-center opacity-30 text-[9px]">
                            FaithReflects ‚Ä¢ Breakthrough Tracker
                        </footer>
                    </div>
                );
            }

            // --- VIEW: DETAIL (FORTRESS) ---
            return (
                <div className={`min-h-screen bg-[#191919] text-[#E3E3E3] font-sans flex flex-col p-4 max-w-sm mx-auto relative overflow-hidden ${isVictory ? 'victory' : ''}`}>
                    
                    {/* Victory Rays */}
                    {isVictory && (
                        <div className="ray-box">
                            {[...Array(8)].map((_, i) => (
                                <div key={i} className="ray" style={{transform: `rotate(${i * 45}deg)`}}></div>
                            ))}
                        </div>
                    )}

                    {/* Header */}
                    <header className="flex justify-between items-center mb-6 relative z-30">
                        <button 
                            onClick={() => setActiveGoalId(null)}
                            className="flex items-center text-stone-400 hover:text-white transition-colors text-xs font-medium"
                        >
                            <Icons.ArrowLeft size={14} className="mr-1"/> Back
                        </button>
                        <span className="text-[10px] text-stone-500 uppercase tracking-widest">March {activeGoal.progress} of 7</span>
                    </header>

                    {/* Title */}
                    <div className="text-center mb-4 relative z-30">
                        <h1 className="text-xl font-bold text-white leading-tight">{activeGoal.title}</h1>
                    </div>

                    {/* Fortress */}
                    <div className={`flex-1 flex flex-col justify-end pb-8 ${isShaking ? 'animate-shake' : ''}`}>
                        <Walls progress={activeGoal.progress} isCrumbled={isVictory} />
                        
                        {/* March Button */}
                        {!isVictory && (
                            <div className="text-center z-30">
                                <button 
                                    onClick={() => updateProgress(activeGoal.id, true)}
                                    className="group relative inline-flex items-center justify-center px-8 py-4 bg-[#2C2C2C] border border-[#333] rounded-full overflow-hidden transition-all hover:border-[#9F6B53] hover:shadow-[0_0_20px_rgba(159,107,83,0.3)] active:scale-95"
                                >
                                    <span className="absolute w-0 h-0 transition-all duration-500 ease-out bg-[#9F6B53] rounded-full group-hover:w-56 group-hover:h-56 opacity-10"></span>
                                    <div className="flex items-center gap-3">
                                        <span className="text-[#9F6B53] group-hover:text-white transition-colors"><Icons.Trumpet size={24} /></span>
                                        <span className="text-sm font-bold uppercase tracking-widest text-stone-300 group-hover:text-white transition-colors">March Now</span>
                                    </div>
                                </button>
                                <p className="mt-4 text-[10px] text-stone-600">
                                    Click to circle the wall in prayer
                                </p>
                            </div>
                        )}
                    </div>

                    {/* Victory Overlay */}
                    {isVictory && (
                        <VictoryDisplay 
                            goal={activeGoal.title} 
                            onComplete={() => deleteGoal(activeGoal.id)} 
                        />
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>